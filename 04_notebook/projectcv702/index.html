<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Introduction In this tutorial I want to show you guys how to go from two distinct images to a single image that is the result of the two images stitched together. This is a very useful technique in computer vision and it is used in many applications such as panorama stitching, object detection and many others. Starting images: The final result: The code Feature extraction 1 2 3 4 5 import random import cv2 as cv import numpy as np import matplotlib."><title>Image Stitching</title>
<link rel=canonical href=https://sebo-the-tramp.github.io/04_notebook/projectcv702/><link rel=stylesheet href=/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="Image Stitching"><meta property='og:description' content="Introduction In this tutorial I want to show you guys how to go from two distinct images to a single image that is the result of the two images stitched together. This is a very useful technique in computer vision and it is used in many applications such as panorama stitching, object detection and many others. Starting images: The final result: The code Feature extraction 1 2 3 4 5 import random import cv2 as cv import numpy as np import matplotlib."><meta property='og:url' content='https://sebo-the-tramp.github.io/04_notebook/projectcv702/'><meta property='og:site_name' content='Sebastian Cavada'><meta property='og:type' content='article'><meta property='article:section' content='04_notebook'><meta property='article:published_time' content='2024-02-22T14:31:13+02:00'><meta property='article:modified_time' content='2024-02-22T14:31:13+02:00'><meta name=twitter:title content="Image Stitching"><meta name=twitter:description content="Introduction In this tutorial I want to show you guys how to go from two distinct images to a single image that is the result of the two images stitched together. This is a very useful technique in computer vision and it is used in many applications such as panorama stitching, object detection and many others. Starting images: The final result: The code Feature extraction 1 2 3 4 5 import random import cv2 as cv import numpy as np import matplotlib."><link rel=icon href=/logo.svg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/big_hu17844177664158792560.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸš€</span></figure><div class=site-meta><h1 class=site-name><a href=/>Sebastian Cavada</a></h1><h2 class=site-description>If you are not building stuff, don't stop people who are!</h2></div></header><ol class=menu-social><li><a href=https://github.com/Sebo-the-tramp target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://github.com/Sebo-the-tramp target=_blank title=Linkedin rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://mobile.twitter.com/_cavada target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://www.youtube.com/channel/UCe2CkR9ldskNh_mVSwpeiLw target=_blank title=Youtube rel=me><svg class="icon icon-tabler icon-tabler-brand-youtube" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="4"/><path d="M10 9l5 3-5 3z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>Whoami</span></a></li><li><a href=/post/><svg class="icon icon-tabler icon-tabler-book" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 19a9 9 0 019 0 9 9 0 019 0"/><path d="M3 6a9 9 0 019 0 9 9 0 019 0"/><line x1="3" y1="6" x2="3" y2="19"/><line x1="12" y1="6" x2="12" y2="19"/><line x1="21" y1="6" x2="21" y2="19"/></svg>
<span>Blog</span></a></li><li><a href=/02_publications/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-certificate-2"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 15m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M10 7h4"/><path d="M10 18v4l2-1 2 1v-4"/><path d="M10 19H8a2 2 0 01-2-2V5a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2h-2"/></svg>
<span>Publications</span></a></li><li><a href=/03_projects/><svg class="icon icon-tabler icon-tabler-circle-square" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="9.5" cy="9.5" r="6.5"/><rect x="10" y="10" width="11" height="11" rx="2"/></svg>
<span>Projects</span></a></li><li class=current><a href=/04_notebook/><svg class="icon icon-tabler icon-tabler-school" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 9 12 5 2 9l10 4 10-4v6"/><path d="M6 10.6V16a6 3 0 0012 0v-5.4"/></svg>
<span>Notebook</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#the-code>The code</a><ol><li><a href=#feature-extraction>Feature extraction</a></li><li><a href=#feature-matching>Feature matching</a></li><li><a href=#ransac---matching-refinement>RANSAC - Matching refinement</a></li><li><a href=#stitching-the-two-images>Stitching the two images</a></li></ol></li><li><a href=#other-examples>Other examples</a></li><li><a href=#photometric-correction>Photometric correction</a></li><li><a href=#conclusion>Conclusion</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/04_notebook/projectcv702/>Image Stitching</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Feb 22, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h2 id=introduction>Introduction</h2><p>In this tutorial I want to show you guys how to go from two distinct images to a single image that is the result of the two images stitched together. This is a very useful technique in computer vision and it is used in many applications such as panorama stitching, object detection and many others.</p><p>Starting images:</p><p><img src=/04_notebook/projectcv702/index_files/01_01.jpg width=818 height=710 srcset="/04_notebook/projectcv702/index_files/01_01_hu9004149062368605700.jpg 480w, /04_notebook/projectcv702/index_files/01_01_hu2939435215310581132.jpg 1024w" loading=lazy alt="Image 1" class=gallery-image data-flex-grow=115 data-flex-basis=276px> <img src=/04_notebook/projectcv702/index_files/01_02.jpg width=816 height=709 srcset="/04_notebook/projectcv702/index_files/01_02_hu7870128502809340639.jpg 480w, /04_notebook/projectcv702/index_files/01_02_hu9919906237170447155.jpg 1024w" loading=lazy alt="Image 2" class=gallery-image data-flex-grow=115 data-flex-basis=276px></p><p>The final result:</p><p><img src=/04_notebook/projectcv702/index_files/index_21_0.png width=552 height=323 srcset="/04_notebook/projectcv702/index_files/index_21_0_hu6340756112964157747.png 480w, /04_notebook/projectcv702/index_files/index_21_0_hu1371914162417847806.png 1024w" loading=lazy alt="Final result" class=gallery-image data-flex-grow=170 data-flex-basis=410px></p><h2 id=the-code>The code</h2><h3 id=feature-extraction>Feature extraction</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>cv2</span> <span class=k>as</span> <span class=nn>cv</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span></code></pre></td></tr></table></div></div><p>SIFT algorithm is going to be used for keypoint extraction and feature description. The algorithm is going to be initialized as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sift</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>SIFT_create</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Next two images are going to be used for the demonstration of the algorithm.
IMPORTANT: the images should be ordered from the left to the right.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>img1</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=s1>&#39;./image pairs/image pairs_01_01.jpg&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img1</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img1</span><span class=p>,</span> <span class=n>cv</span><span class=o>.</span><span class=n>COLOR_RGB2BGR</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gray1</span><span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img1</span><span class=p>,</span><span class=n>cv</span><span class=o>.</span><span class=n>COLOR_BGR2GRAY</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>kp1</span> <span class=o>=</span> <span class=n>sift</span><span class=o>.</span><span class=n>detect</span><span class=p>(</span><span class=n>gray1</span><span class=p>,</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img1sift</span><span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>drawKeypoints</span><span class=p>(</span><span class=n>gray1</span><span class=p>,</span><span class=n>kp1</span><span class=p>,</span><span class=n>gray1</span><span class=p>,</span><span class=n>flags</span><span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>img2</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>imread</span><span class=p>(</span><span class=s1>&#39;./image pairs/image pairs_01_02.jpg&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img2</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img2</span><span class=p>,</span> <span class=n>cv</span><span class=o>.</span><span class=n>COLOR_RGB2BGR</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>gray2</span><span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>cvtColor</span><span class=p>(</span><span class=n>img2</span><span class=p>,</span><span class=n>cv</span><span class=o>.</span><span class=n>COLOR_BGR2GRAY</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>kp2</span> <span class=o>=</span> <span class=n>sift</span><span class=o>.</span><span class=n>detect</span><span class=p>(</span><span class=n>gray2</span><span class=p>,</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img2sift</span> <span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>drawKeypoints</span><span class=p>(</span><span class=n>gray2</span><span class=p>,</span><span class=n>kp2</span><span class=p>,</span><span class=n>gray2</span><span class=p>,</span><span class=n>flags</span><span class=o>=</span><span class=n>cv</span><span class=o>.</span><span class=n>DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>With the images open now the SIFT algorithm can be run on each of them. The keypoints and descriptors are going to be extracted and stored in the variables kp1, des1, kp2, des2.</p><p>Following are the two images with the descriptors visualized. It can be noted that some of the descriptors are similar and in similar positions in both images.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>nrows</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>ncols</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span><span class=mi>20</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>img1sift</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>img2sift</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/04_notebook/projectcv702/index_files/index_7_0.png width=1606 height=660 srcset="/04_notebook/projectcv702/index_files/index_7_0_hu8638039003733557431.png 480w, /04_notebook/projectcv702/index_files/index_7_0_hu17571914677782577069.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=243 data-flex-basis=584px></p><h3 id=feature-matching>Feature matching</h3><p>Now that the points have been computed, the next step is to match the points. This is done by using the FLANN algorithm. This Algorithm is faster than the brute force approach and gives the same accuracy. It involves trees and it is a best fit when the number of matches is high, which is exactly our case.</p><p>After matching the points a further refinement is done with the ratio test. This test is used to filter out the points that are not similar enough. The test is done by comparing the distance of the closest point to the distance of the second closest point. If the ratio is less than a certain threshold, the point is considered a good match.</p><p>The result is shown in the figure below. The matches are visualized with lines connecting the points. It can be seen that the matches are not perfect, this is why we are going to refine them in the next step.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Initiate SIFT detector</span>
</span></span><span class=line><span class=cl><span class=n>sift</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>SIFT_create</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># find the keypoints and descriptors with SIFT</span>
</span></span><span class=line><span class=cl><span class=n>kp1</span><span class=p>,</span> <span class=n>des1</span> <span class=o>=</span> <span class=n>sift</span><span class=o>.</span><span class=n>detectAndCompute</span><span class=p>(</span><span class=n>gray1</span><span class=p>,</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>kp2</span><span class=p>,</span> <span class=n>des2</span> <span class=o>=</span> <span class=n>sift</span><span class=o>.</span><span class=n>detectAndCompute</span><span class=p>(</span><span class=n>gray2</span><span class=p>,</span><span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># FLANN parameters</span>
</span></span><span class=line><span class=cl><span class=n>FLANN_INDEX_KDTREE</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>index_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>algorithm</span> <span class=o>=</span> <span class=n>FLANN_INDEX_KDTREE</span><span class=p>,</span> <span class=n>trees</span> <span class=o>=</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>search_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>checks</span><span class=o>=</span><span class=mi>50</span><span class=p>)</span>   <span class=c1># or pass empty dictionary</span>
</span></span><span class=line><span class=cl><span class=n>flann</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>FlannBasedMatcher</span><span class=p>(</span><span class=n>index_params</span><span class=p>,</span><span class=n>search_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>matches</span> <span class=o>=</span> <span class=n>flann</span><span class=o>.</span><span class=n>knnMatch</span><span class=p>(</span><span class=n>des1</span><span class=p>,</span><span class=n>des2</span><span class=p>,</span><span class=n>k</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># Need to draw only good matches, so create a mask</span>
</span></span><span class=line><span class=cl><span class=n>matchesMask</span> <span class=o>=</span> <span class=p>[[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>matches</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=n>good</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=c1># ratio test as per Lowe&#39;s paper</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span><span class=p>,(</span><span class=n>m</span><span class=p>,</span><span class=n>n</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>matches</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>m</span><span class=o>.</span><span class=n>distance</span> <span class=o>&lt;</span> <span class=mf>0.7</span><span class=o>*</span><span class=n>n</span><span class=o>.</span><span class=n>distance</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>matchesMask</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>good</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>m</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>draw_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>matchColor</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                   <span class=n>singlePointColor</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                   <span class=n>matchesMask</span> <span class=o>=</span> <span class=n>matchesMask</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>flags</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>DrawMatchesFlags_DEFAULT</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img3</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>drawMatchesKnn</span><span class=p>(</span><span class=n>img1</span><span class=p>,</span><span class=n>kp1</span><span class=p>,</span><span class=n>img2</span><span class=p>,</span><span class=n>kp2</span><span class=p>,</span><span class=n>matches</span><span class=p>,</span><span class=kc>None</span><span class=p>,</span><span class=o>**</span><span class=n>draw_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>img3</span><span class=p>,),</span><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/04_notebook/projectcv702/index_files/index_9_0.png width=559 height=264 srcset="/04_notebook/projectcv702/index_files/index_9_0_hu2748341010802411974.png 480w, /04_notebook/projectcv702/index_files/index_9_0_hu9974774133040226429.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=211 data-flex-basis=508px></p><pre><code>(&lt;matplotlib.image.AxesImage at 0x1571581c0&gt;, None)
</code></pre><p>From the previous image it can be seen that some green lines do not match corresponding keypoints. This is why we are going to use the RANSAC algorithm to further refine the matches. The RANSAC algorithm is going to be used to find the best transformation between the two images. The transformation is going to be used to warp the second image to the first one.</p><h3 id=ransac---matching-refinement>RANSAC - Matching refinement</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>src_pts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>([</span> <span class=n>kp1</span><span class=p>[</span><span class=n>m</span><span class=o>.</span><span class=n>queryIdx</span><span class=p>]</span><span class=o>.</span><span class=n>pt</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>good</span> <span class=p>])[:</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>dst_pts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>([</span> <span class=n>kp2</span><span class=p>[</span><span class=n>m</span><span class=o>.</span><span class=n>trainIdx</span><span class=p>]</span><span class=o>.</span><span class=n>pt</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>good</span> <span class=p>])[:</span><span class=mi>4</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>In particular the RANSAC algorithm works as follows:</p><ol><li>Randomly select n points from the matches</li><li>Compute the transformation</li><li>Count the number of inliers, that is, if we take this transformation as the correct one, how many points are close to the transformed points (we need to consider all the points and not only the n points we used to compute the transformation)</li><li>Repeat the process for a number of iterations to find the best combination of points that minimizes the transformation error</li></ol><p>Once the iteration is finished we can consider with a high degree of confidence that the current transformation is the closest to the real one. The transformation is then used to warp the second image to the first one.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>transform</span><span class=p>(</span><span class=n>H</span><span class=p>,</span> <span class=n>src</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>row</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>src</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>src</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>vstack</span><span class=p>([</span><span class=n>src</span><span class=p>,</span> <span class=n>row</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=n>H</span> <span class=o>@</span> <span class=n>src</span>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=o>/</span> <span class=n>out</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>FindBestHomography</span><span class=p>(</span><span class=n>src_pts</span><span class=p>,</span> <span class=n>dst_pts</span><span class=p>,</span> <span class=n>ransacReprojThreshold</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>maxIters</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>min_sample</span><span class=o>=</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>best_inliers_count</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>best_inliers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>src_pts</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>bool</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>best_residual_sum</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>inf</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>maxIters</span><span class=p>):</span>        
</span></span><span class=line><span class=cl>        <span class=n>indices</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>src_pts</span><span class=p>)),</span> <span class=n>k</span><span class=o>=</span><span class=n>min_sample</span><span class=p>)</span>        
</span></span><span class=line><span class=cl>        <span class=n>src_</span><span class=p>,</span> <span class=n>dst_</span> <span class=o>=</span> <span class=n>src_pts</span><span class=p>[</span><span class=n>indices</span><span class=p>],</span> <span class=n>dst_pts</span><span class=p>[</span><span class=n>indices</span><span class=p>]</span>        
</span></span><span class=line><span class=cl>        <span class=n>H</span> <span class=o>=</span> <span class=n>myfindHomography</span><span class=p>(</span><span class=n>src_</span><span class=p>,</span> <span class=n>dst_</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>est_dst</span> <span class=o>=</span> <span class=n>transform</span><span class=p>(</span><span class=n>H</span><span class=p>,</span> <span class=n>src_pts</span><span class=o>.</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>est_dst</span> <span class=o>=</span> <span class=n>est_dst</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>        <span class=n>inliers</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>src_pts</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>bool</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>distances</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>norm</span><span class=p>(</span><span class=n>est_dst</span> <span class=o>-</span> <span class=n>dst_pts</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>inliers</span><span class=p>[</span><span class=n>distances</span> <span class=o>&lt;</span> <span class=n>ransacReprojThreshold</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=n>curr_inliers_count</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>inliers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>curr_residual_sum</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>distances</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>curr_inliers_count</span> <span class=o>&gt;</span> <span class=n>best_inliers_count</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>best_inliers_count</span> <span class=o>=</span> <span class=n>curr_inliers_count</span>
</span></span><span class=line><span class=cl>            <span class=n>best_inliers</span> <span class=o>=</span> <span class=n>inliers</span>
</span></span><span class=line><span class=cl>            <span class=n>best_residual_sum</span> <span class=o>=</span> <span class=n>curr_residual_sum</span>            
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>curr_inliers_count</span> <span class=o>==</span> <span class=n>best_inliers_count</span> <span class=ow>and</span> <span class=n>curr_residual_sum</span> <span class=o>&lt;</span> <span class=n>best_residual_sum</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>best_inliers_count</span> <span class=o>=</span> <span class=n>curr_inliers_count</span>
</span></span><span class=line><span class=cl>            <span class=n>best_inliers</span> <span class=o>=</span> <span class=n>inliers</span>
</span></span><span class=line><span class=cl>            <span class=n>best_residual_sum</span> <span class=o>=</span> <span class=n>curr_residual_sum</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>inliers_indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>nonzero</span><span class=p>(</span><span class=n>best_inliers</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>    
</span></span><span class=line><span class=cl>    <span class=n>H</span> <span class=o>=</span> <span class=n>myfindHomography</span><span class=p>(</span><span class=n>src_pts</span><span class=p>[</span><span class=n>inliers_indices</span><span class=p>],</span> <span class=n>dst_pts</span><span class=p>[</span><span class=n>inliers_indices</span><span class=p>])</span>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>H</span><span class=p>,</span> <span class=n>inliers_indices</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>myfindHomography</span><span class=p>(</span><span class=n>src_pts</span><span class=p>,</span> <span class=n>dst_pts</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>src_pts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;=</span> <span class=mi>3</span>  <span class=c1># Minimum 3 corresponding points are required</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>src_pts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>dst_pts</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># The number of src points should be same as of dst points</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>src_pts</span><span class=p>)):</span>        
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>src_pts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>u</span><span class=p>,</span> <span class=n>v</span> <span class=o>=</span> <span class=n>dst_pts</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>A</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=o>-</span><span class=n>u</span><span class=o>*</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>u</span><span class=o>*</span><span class=n>y</span><span class=p>,</span> <span class=o>-</span><span class=n>u</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>A</span><span class=o>.</span><span class=n>append</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=n>v</span><span class=o>*</span><span class=n>x</span><span class=p>,</span> <span class=o>-</span><span class=n>v</span><span class=o>*</span><span class=n>y</span><span class=p>,</span> <span class=o>-</span><span class=n>v</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>Vh</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>svd</span><span class=p>(</span><span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>L</span> <span class=o>=</span> <span class=n>Vh</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,:]</span> <span class=o>/</span> <span class=n>Vh</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>H</span> <span class=o>=</span> <span class=n>L</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>H</span>
</span></span></code></pre></td></tr></table></div></div><p>All the code you see above seems gibberish, but is actually the implementation of the bullet points that I described earlier.</p><p>In particular:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>def transform(...)
</span></span></code></pre></td></tr></table></div></div><p>is responsible for transforming the source points to the destination points given any homgraphy matrix.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>def myFindHomography(...)
</span></span></code></pre></td></tr></table></div></div><p>Is responsible for finding the homography matrix given the source and destination points.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>def findBestHomography(...)
</span></span></code></pre></td></tr></table></div></div><p>Is responsible to run the RANSAC algorithm and find the best homography matrix. It calls many times both the previous functions to find the best homography matrix.</p><p>Next we can compute the best homography matrix and warp the second image to the first one. We also get the indices of the points that are inliers and we can visualize them. We remove all points that are not the best fits by applying the mask to the matches.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>good</span><span class=p>)</span><span class=o>&gt;</span><span class=mi>10</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>src_pts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>([</span> <span class=n>kp1</span><span class=p>[</span><span class=n>m</span><span class=o>.</span><span class=n>queryIdx</span><span class=p>]</span><span class=o>.</span><span class=n>pt</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>good</span> <span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>dst_pts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>([</span> <span class=n>kp2</span><span class=p>[</span><span class=n>m</span><span class=o>.</span><span class=n>trainIdx</span><span class=p>]</span><span class=o>.</span><span class=n>pt</span> <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>good</span> <span class=p>])</span>    
</span></span><span class=line><span class=cl>    <span class=n>M</span><span class=p>,</span> <span class=n>inliers_indices</span> <span class=o>=</span> <span class=n>FindBestHomography</span><span class=p>(</span><span class=n>src_pts</span><span class=p>,</span> <span class=n>dst_pts</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=mi>40</span><span class=p>)</span>    
</span></span><span class=line><span class=cl>    <span class=n>matchesMask</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span> <span class=k>if</span> <span class=n>i</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>inliers_indices</span> <span class=k>else</span> <span class=mi>1</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>good</span><span class=p>))]</span>    
</span></span><span class=line><span class=cl>    <span class=c1># h,w, _ = img1.shape</span>
</span></span><span class=line><span class=cl>    <span class=c1># pts = np.float32([ [0,0],[0,h-1],[w-1,h-1],[w-1,0] ]).reshape(-1,1,2)</span>
</span></span><span class=line><span class=cl>    <span class=c1># dst = cv.perspectiveTransform(pts,M)</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span> <span class=s2>&#34;Not enough matches are found - </span><span class=si>{}</span><span class=s2>/</span><span class=si>{}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>good</span><span class=p>),</span> <span class=mi>10</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>matchesMask</span> <span class=o>=</span> <span class=kc>None</span>
</span></span></code></pre></td></tr></table></div></div><p>We can visualize our predicted homography matrix and the refined matches. The result is shown in the figure below. It can be seen that the matches are now much better and the green lines are now connecting the correct keypoints.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>M</span>
</span></span></code></pre></td></tr></table></div></div><pre><code>array([[ 9.99962996e-01,  1.45216964e-05, -4.62984718e+02],
       [-1.84901804e-05,  1.00002364e+00,  8.65968096e-03],
       [-1.51650074e-08,  4.51000004e-08,  1.00000000e+00]])
</code></pre><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>draw_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>matchColor</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>0</span><span class=p>),</span> <span class=c1># draw matches in green color</span>
</span></span><span class=line><span class=cl>                   <span class=n>singlePointColor</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>matchesMask</span> <span class=o>=</span> <span class=n>matchesMask</span><span class=p>,</span> <span class=c1># draw only inliers</span>
</span></span><span class=line><span class=cl>                   <span class=n>flags</span> <span class=o>=</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>img3</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>drawMatches</span><span class=p>(</span><span class=n>img1</span><span class=p>,</span><span class=n>kp1</span><span class=p>,</span><span class=n>img2</span><span class=p>,</span><span class=n>kp2</span><span class=p>,</span><span class=n>good</span><span class=p>,</span><span class=kc>None</span><span class=p>,</span><span class=o>**</span><span class=n>draw_params</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>img3</span><span class=p>,</span> <span class=s1>&#39;gray&#39;</span><span class=p>),</span><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/04_notebook/projectcv702/index_files/index_19_0.png width=559 height=264 srcset="/04_notebook/projectcv702/index_files/index_19_0_hu15750189650407418918.png 480w, /04_notebook/projectcv702/index_files/index_19_0_hu6812298530898650495.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=211 data-flex-basis=508px></p><pre><code>(&lt;matplotlib.image.AxesImage at 0x16c2ca8c0&gt;, None)
</code></pre><h3 id=stitching-the-two-images>Stitching the two images</h3><p>The last part of the code involves creating a new frame for the images based on their projected new positions. The new frame is going to be the calculated from the new coordinates of the second image projected by the homography matrix and the original frame of the first image. The new frame is going to be the maximum of the two frames.</p><p>Then the function $\text{cv2.warpPerspective}$ is going to be used to warp the second image to the first one. The result is shown in the figure below. It can be seen that the second image is now warped to the first one and the two images are now aligned.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># keep the corners</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>h1</span><span class=p>,</span> <span class=n>w1</span> <span class=o>=</span> <span class=n>img1</span><span class=o>.</span><span class=n>shape</span><span class=p>[:</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>h2</span><span class=p>,</span> <span class=n>w2</span> <span class=o>=</span> <span class=n>img2</span><span class=o>.</span><span class=n>shape</span><span class=p>[:</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>corners1</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>h1</span><span class=p>],</span> <span class=p>[</span><span class=n>w1</span><span class=p>,</span> <span class=n>h1</span><span class=p>],</span> <span class=p>[</span><span class=n>w1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]],</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>corners2</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=n>h2</span><span class=p>],</span> <span class=p>[</span><span class=n>w2</span><span class=p>,</span> <span class=n>h2</span><span class=p>],</span> <span class=p>[</span><span class=n>w2</span><span class=p>,</span> <span class=mi>0</span><span class=p>]],</span> <span class=n>dtype</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>float32</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>warped_corners2</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>perspectiveTransform</span><span class=p>(</span><span class=n>corners2</span><span class=p>,</span> <span class=n>M</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>all_corners</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>concatenate</span><span class=p>((</span><span class=n>corners1</span><span class=p>,</span> <span class=n>warped_corners2</span><span class=p>),</span> <span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>x_min</span><span class=p>,</span> <span class=n>y_min</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>(</span><span class=n>all_corners</span><span class=o>.</span><span class=n>min</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>x_max</span><span class=p>,</span> <span class=n>y_max</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>int32</span><span class=p>(</span><span class=n>all_corners</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span><span class=o>.</span><span class=n>ravel</span><span class=p>()</span> <span class=o>+</span> <span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>translation_dist</span> <span class=o>=</span> <span class=p>[</span><span class=o>-</span><span class=n>x_min</span><span class=p>,</span> <span class=o>-</span><span class=n>y_min</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>H_translation</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>translation_dist</span><span class=p>[</span><span class=mi>0</span><span class=p>]],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>translation_dist</span><span class=p>[</span><span class=mi>1</span><span class=p>]],</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>warped_img2</span> <span class=o>=</span> <span class=n>cv</span><span class=o>.</span><span class=n>warpPerspective</span><span class=p>(</span><span class=n>img1</span><span class=p>,</span> <span class=n>H_translation</span> <span class=o>@</span> <span class=n>M</span><span class=p>,</span> <span class=p>(</span><span class=n>x_max</span> <span class=o>-</span> <span class=n>x_min</span><span class=p>,</span> <span class=n>y_max</span> <span class=o>-</span> <span class=n>y_min</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>warped_img2</span><span class=p>[</span><span class=n>translation_dist</span><span class=p>[</span><span class=mi>1</span><span class=p>]:</span><span class=n>h2</span><span class=o>+</span><span class=n>translation_dist</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>translation_dist</span><span class=p>[</span><span class=mi>0</span><span class=p>]:</span><span class=n>w2</span><span class=o>+</span><span class=n>translation_dist</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span> <span class=o>=</span> <span class=n>img2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>warped_img2</span><span class=p>),</span><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/04_notebook/projectcv702/index_files/index_21_0.png width=552 height=323 srcset="/04_notebook/projectcv702/index_files/index_21_0_hu6340756112964157747.png 480w, /04_notebook/projectcv702/index_files/index_21_0_hu1371914162417847806.png 1024w" loading=lazy alt=png class=gallery-image data-flex-grow=170 data-flex-basis=410px></p><h2 id=other-examples>Other examples</h2><p>For my project I had to use different images to test the algorithm. The results are shown in the figures below. It can be seen that the algorithm works well and the two images are stitched together.</p><p><img src=/04_notebook/projectcv702/index_files/02_01.png width=375 height=500 srcset="/04_notebook/projectcv702/index_files/02_01_hu6582050698691998791.png 480w, /04_notebook/projectcv702/index_files/02_01_hu11911057946565053860.png 1024w" loading=lazy alt="Image 2" class=gallery-image data-flex-grow=75 data-flex-basis=180px> <img src=/04_notebook/projectcv702/index_files/02_02.png width=375 height=500 srcset="/04_notebook/projectcv702/index_files/02_02_hu1300807446059429135.png 480w, /04_notebook/projectcv702/index_files/02_02_hu16703259215182449396.png 1024w" loading=lazy alt="Image 2" class=gallery-image data-flex-grow=75 data-flex-basis=180px></p><p><img src=/04_notebook/projectcv702/index_files/output2.png width=459 height=418 srcset="/04_notebook/projectcv702/index_files/output2_hu17351445839374171548.png 480w, /04_notebook/projectcv702/index_files/output2_hu13615970569382082313.png 1024w" loading=lazy alt="Image 2" class=gallery-image data-flex-grow=109 data-flex-basis=263px></p><p><img src=/04_notebook/projectcv702/index_files/04_01.jpg width=640 height=427 srcset="/04_notebook/projectcv702/index_files/04_01_hu9548119727972883723.jpg 480w, /04_notebook/projectcv702/index_files/04_01_hu2823908917036553774.jpg 1024w" loading=lazy alt="Image 4" class=gallery-image data-flex-grow=149 data-flex-basis=359px> <img src=/04_notebook/projectcv702/index_files/04_02.jpg width=640 height=427 srcset="/04_notebook/projectcv702/index_files/04_02_hu483828891137107872.jpg 480w, /04_notebook/projectcv702/index_files/04_02_hu7480874801331160156.jpg 1024w" loading=lazy alt="Image 4" class=gallery-image data-flex-grow=149 data-flex-basis=359px></p><p><img src=/04_notebook/projectcv702/index_files/output4.png width=500 height=418 srcset="/04_notebook/projectcv702/index_files/output4_hu3975811125251704556.png 480w, /04_notebook/projectcv702/index_files/output4_hu16691621227973291534.png 1024w" loading=lazy alt="Image 4" class=gallery-image data-flex-grow=119 data-flex-basis=287px></p><p><img src=/04_notebook/projectcv702/index_files/03_01.jpg width=1024 height=683 srcset="/04_notebook/projectcv702/index_files/03_01_hu2260950240774072207.jpg 480w, /04_notebook/projectcv702/index_files/03_01_hu11146995896639363091.jpg 1024w" loading=lazy alt="Image 3" class=gallery-image data-flex-grow=149 data-flex-basis=359px> <img src=/04_notebook/projectcv702/index_files/03_02.jpg width=1024 height=683 srcset="/04_notebook/projectcv702/index_files/03_02_hu15393106339373188351.jpg 480w, /04_notebook/projectcv702/index_files/03_02_hu3997338351819873297.jpg 1024w" loading=lazy alt="Image 3" class=gallery-image data-flex-grow=149 data-flex-basis=359px></p><p><img src=/04_notebook/projectcv702/index_files/output3.png width=556 height=307 srcset="/04_notebook/projectcv702/index_files/output3_hu14637647475487881.png 480w, /04_notebook/projectcv702/index_files/output3_hu4517956756991137109.png 1024w" loading=lazy alt="Image 3" class=gallery-image data-flex-grow=181 data-flex-basis=434px></p><p>Note: Especially in the last one it can be noted that the images have different colors. In the next section we are going to see how to fix this issue.</p><h2 id=photometric-correction>Photometric correction</h2><h2 id=conclusion>Conclusion</h2><p>As promised the two images have been stitched together and the result is shown in the figure above. The process is quite simple and it is based on the extraction of keypoints and descriptors, the matching of the keypoints and the refinement of the matches with the RANSAC algorithm. The final result is a single image that is the result of the two images stitched together.</p></section><footer class=article-footer></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><div class="article-list--compact links"><article><a href=stitch_1.ipynb target=_blank rel=noopener><div class=article-details><h2 class=article-title>Complete jupyter notebook</h2><footer class=article-time>Click on the link to download the full jupyter notebook</footer></div></a></article></div><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Sebastian Cavada</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>